/* Created by Tonakai */
(function(){var a,b;a=function(){function a(a,b){this.el=$(a),this.status=this.el.attr(b.options.attributeName),this.step=b.options.defaultStep,this.position=this.el.position(),this.borders=this.getBorders(),this.nextOffset={left:0,top:0},this.width=this.el.width(),this.el.droppable({tolerance:"fit",hoverClass:"highlighted",scope:b.scope,create:function(a){return function(){return a.el.css("z-index",1)}}(this),drop:function(a){return function(b,c){var d;return d=a.widget.getTask(c.draggable),a.widget.onDrop(d,a)}}(this),accept:function(){return function(){return!0}}(this)}),this.widget=b}return a.count=2,a.getIndex=function(){return a.count+=1,a.count},a.prototype.getBorders=function(){return{left:parseInt(this.el.css("border-left-width"))+parseInt(this.el.css("padding-left"))+parseInt(this.el.css("margin-left")),right:parseInt(this.el.css("border-right-width"))+parseInt(this.el.css("padding-right"))+parseInt(this.el.css("margin-right")),top:parseInt(this.el.css("border-top-width"))+parseInt(this.el.css("padding-top"))+parseInt(this.el.css("margin-top")),bottom:parseInt(this.el.css("border-bottom-width"))+parseInt(this.el.css("padding-bottom"))+parseInt(this.el.css("margin-bottom"))}},a.prototype.getNextOffset=function(a,b){var c,d,e,f;return f=this.width-a-this.borders.right,d=this.el.height()-b,c=this.nextOffset,this.nextOffset={left:(this.nextOffset.left+this.step.left)%f,top:this.nextOffset.top+this.step.top},e={left:this.borders.left+this.position.left+c.left,top:this.borders.top+c.top},e.top>d&&this.widget.setHeight(e.top+b+this.borders.bottom),e},a.prototype.setHeight=function(a){return null==a&&(a=this.widget.options.resizable.minHeight||0),this.el.css("height",a+"px")},a}(),b=function(){function b(b,c){this.el=b,this.widget=c,this.position=this.el.position(),this.status=!1,this.storage=function(){},this.id=this.el.attr("rel"),this.el.draggable({stack:"div",distance:0,scope:this.widget.scope,containment:"parent",create:function(b){return function(){return b.el.css("z-index",a.getIndex())}}(this),start:function(a){return function(){return a.startMove(),a.widget.onDragStart(a)}}(this),revert:function(a){return function(b){return a.widget.onDragRevert(a),a.widget.isDroppable(b)?!1:!0}}(this),stop:function(a){return function(){return a.widget.onDragEnd(a)}}(this)})}return b.prototype.render=function(){return this.el.show()},b.prototype.update=function(){},b.prototype.setStatus=function(a){return this.status=a,this.widget.validBox(this.position,this)?void 0:(this.setPosition(null,this.widget.options.animationTime),this.store())},b.prototype.getStorageKey=function(){return"project_"+this.widget.kbnId+"task_"+this.id},b.prototype.store=function(){var a;return a=this.position,a.status=this.status,this.storage(this.getStorageKey(),a)},b.prototype.restore=function(){var a;return a=this.storage(this.getStorageKey()),null!=a&&null!=a.status&&this.widget.validBox(a,this)?void this.setPosition(a):(this.setPosition(),this.store())},b.prototype.startMove=function(){return this.position=this.el.position()},b.prototype.completeMove=function(){var a,b;return b=this.el.position(),a=this.widget.getDropByPosition(b),null==a?this.failMove():(this.position=b,a.status!==this.status&&(this.status=a.status,this.widget.onStatusChange(this)),this.store())},b.prototype.failMove=function(){return this.el.animate(this.position,this.widget.options.animationTime,function(a){return function(){return a.store()}}(this))},b.prototype.getPositionDefault=function(){var a,b,c,d;return a=this.widget.dropAreas[this.status],c=this.el.width(),b=this.el.height(),d=a.getNextOffset(c,b)},b.prototype.setPosition=function(a,b){var c,d;return null==b&&(b=0),null==a&&(a=this.getPositionDefault()),c=this.widget.offset,a={left:a.left,top:a.top},d=this.el.height(),d+a.top>this.widget.getHeight()&&this.widget.setHeight(d+a.top),this.el.animate(a,b),this.position=this.el.position()},b.prototype.initialize=function(){return this.restore(),this.update(),this.render()},b}(),function(c){return c.widget("tonakai.kanban",{options:{animationTime:200,storagePrefix:"hl_kb_",defaultStep:{left:40,top:40},drops:".js-tasks-column",tasks:".js-task-wrapper",attributeName:"rel",resizable:{minHeight:400}},getDropByPosition:function(a){var b,c,d;d=this.dropAreas;for(c in d)if(b=d[c],b.position.left+b.borders.left<a.left&&b.position.left+b.width-b.borders.right>a.left)return b;return!1},validBox:function(a,b){var c,d;return d=this.dropAreas[b.status],null==d?!1:(c={left:d.position.left+d.borders.left,right:d.position.left+d.width-d.borders.right},a.left<c.left?!1:a.left>c.right?!1:a.left+b.el.width()>c.right?!1:!0)},onStatusChange:function(a){return this._trigger(":onstatuschange",this,a)},onDrop:function(a,b){return this._trigger(":ondrop",this,{drop:b,task:a})},onDragRevert:function(a){return this._trigger(":dragrevert",this,a)},onDragStart:function(a){return this._trigger(":dragstart",this,a)},onDragEnd:function(a){return this._trigger(":dragend",this,a)},_storeHeight:function(a){return window.localStorage.setItem(this._storeResizeKey(),a)},_restoreHeight:function(){var a,b;if(b=window.localStorage.getItem(this._storeResizeKey()),null==b)return this.options.resizable.minHeight;try{return b=JSON.parse(b)}catch(c){return a=c,this.options.resizable.minHeight}},getTask:function(a){var b;return b=a.attr(this.options.attributeName),this.tasks[b]?this.tasks[b]:!1},_create:function(){return this._browser_is_supported()&&this._dependencies_resolved()?(this.kbnId=this.element.attr(this.options.attributeName),this.dropAreas={},this.tasks={},this.scope="project_kanban_"+this.kbnId,this.offset=this.element.offset(),this._setup()):!1},_setOption:function(a,b){return this.options[a]=b,this._super(a,b),this.update()},_setup:function(){return this._initDrops(),this._initTasks(),this._initResizable(),this._trigger(":ready",this)},setHeight:function(a){var b;this.element.css("height",a+"px");for(b in this.drops)b.setHeight(a);return this._storeHeight(a)},getHeight:function(){return this.element.height()},_initResizable:function(){return this.element.resizable({handles:"s",minHeight:400,create:function(a){return function(){var b;return b=a._restoreHeight(),a.setHeight(b)}}(this),stop:function(a){return function(){var b,c;c=a.element.height();for(b in a.drops)b.setHeight(c);return a._storeHeight(c)}}(this)})},isDroppable:function(a){return("function"==typeof a.hasClass?a.hasClass(this.options.drops.slice(1)):void 0)?!0:!1},_storeResizeKey:function(){return this.storagePrefix+"project_"+this.knbId},_initDrops:function(){return this.element.find(this.options.drops).each(function(a){return function(b,d){var e;return e=c(d),a.addDrop(e)}}(this))},_initTasks:function(){return this.element.find(this.options.tasks).each(function(a){return function(b,d){var e;return e=c(d),a.addTask(e)}}(this))},update:function(){return this.render()},addDrop:function(b){return this.dropAreas[b.attr(this.options.attributeName)]=new a(b,this),this._trigger(":dropadd",this,this.dropAreas[b.attr(this.options.attributeName)])},addTask:function(a){var c;return c=new b(a,this),this.tasks[a.attr(this.options.attributeName)]=c,this._trigger(":taskadd",this,this.tasks[a.attr(this.options.attributeName)]),c.initialize()},render:function(){var a,b,c;b=this.tasks;for(a in b)c=b[a],c.render()},_browser_is_supported:function(){return"Microsoft Internet Explorer"===window.navigator.appName?document.documentMode>=8:/iP(od|hone)/i.test(window.navigator.userAgent)?!1:/Android/i.test(window.navigator.userAgent)&&/Mobile/i.test(window.navigator.userAgent)?!1:!0},_dependencies_resolved:function(){return null==c().draggable?!1:null==c().droppable?!1:!0}})}(jQuery)}).call(this);