/* Created by Tonakai */
(function(){var a,b;a=function(){function a(a,b){this.el=$(a),this.status=this.el.attr(b.options.attributeName),this.step=b.options.defaultStep,this.position=this.el.position(),this.borders=this.getBorders(),this.nextOffset={left:0,top:0},this.width=this.el.width(),this.el.droppable({tolerance:"fit",hoverClass:"highlighted",scope:b.scope,drop:function(a){return function(b,c){var d;return d=a.widget.getTask(c.draggable),a.widget.onDrop(d,a)}}(this),accept:function(){return function(){return!0}}(this)}),this.widget=b}return a.prototype.getBorders=function(){return{left:parseInt(this.el.css("border-left-width"))+parseInt(this.el.css("padding-left"))+parseInt(this.el.css("margin-left")),right:parseInt(this.el.css("border-right-width"))+parseInt(this.el.css("padding-right"))+parseInt(this.el.css("margin-right")),top:parseInt(this.el.css("border-top-width"))+parseInt(this.el.css("padding-top"))+parseInt(this.el.css("margin-top")),bottom:parseInt(this.el.css("border-bottom-width"))+parseInt(this.el.css("padding-bottom"))+parseInt(this.el.css("margin-bottom"))}},a.prototype.getNextOffset=function(a){var b,c,d;return d=this.width-a-this.borders.right,b=this.nextOffset,this.nextOffset={left:(this.nextOffset.left+this.step.left)%d,top:this.nextOffset.top+this.step.top},c={left:this.borders.left+this.position.left+b.left,top:this.borders.top+b.top}},a.prototype.setHeight=function(a){return null==a&&(a=this.widget.options.resizable.minHeight||0),this.el.css("height",a+"px")},a}(),b=function(){function a(a,b){this.el=a,this.widget=b,this.position=this.el.position(),this.status=!1,this.storage=function(){},this.id=this.el.attr("rel"),this.el.draggable({stack:"div",distance:0,scope:this.widget.scope,containment:"parent",create:function(){return function(){}}(this),start:function(a){return function(){return a.startMove(),a.widget.onDragStart(a)}}(this),revert:function(a){return function(b){return a.widget.onDragRevert(a),a.widget.isDroppable(b)?!1:!0}}(this),stop:function(a){return function(){return a.widget.onDragEnd(a)}}(this)})}return a.prototype.render=function(){return this.el.show()},a.prototype.update=function(){},a.prototype.getStorageKey=function(){return"project_"+this.widget.kbnId+"task_"+this.id},a.prototype.store=function(){var a;return a=this.position,a.status=this.status,this.storage(this.getStorageKey(),a)},a.prototype.restore=function(){var a;return a=this.storage(this.getStorageKey()),null!=a&&null!=a.status&&this.widget.validBox(this)?void this.setPosition(a):(this.setPosition(),this.store())},a.prototype.startMove=function(){return this.position=this.el.position()},a.prototype.completeMove=function(){return this.position=this.el.position(),this.store()},a.prototype.failMove=function(){return this.el.animate(this.position,this.widget.options.animationTime,function(a){return function(){return a.store()}}(this))},a.prototype.getPositionDefault=function(){var a,b,c;return a=this.widget.dropAreas[this.status],b=this.el.width(),c=a.getNextOffset(b)},a.prototype.setPosition=function(a){var b;return null==a&&(a=this.getPositionDefault()),b=this.widget.offset,a={left:a.left,top:a.top},this.el.animate(a,0),this.position=this.el.position()},a.prototype.initialize=function(){return this.restore(),this.update(),this.render()},a}(),function(c){return c.widget("tonakai.kanban",{options:{animationTime:200,storagePrefix:"hl_kb_",defaultStep:{left:40,top:40},drops:".js-tasks-column",tasks:".js-task-wrapper",attributeName:"rel",resizable:{minHeight:400}},validBox:function(a){var b,c;return c=this.dropAreas[a.status],null==c?!1:(b={left:c.position.left,right:c.position.left+c.width},a.position.left<b.left?!1:a.position.left+a.width>b.right?!1:!0)},onDrop:function(a,b){return this._trigger(":ondrop",this,{drop:b,task:a})},onDragRevert:function(a){return this._trigger(":dragrevert",this,a)},onDragStart:function(a){return this._trigger(":dragstart",this,a)},onDragEnd:function(a){return this._trigger(":dragend",this,a)},_storeHeight:function(a){return window.localStorage.setItem(this._storeResizeKey(),a)},_restoreHeight:function(){var a,b;if(b=window.localStorage.getItem(this._storeResizeKey()),null==b)return this.options.resizable.minHeight;try{return b=JSON.parse(b)}catch(c){return a=c,this.options.resizable.minHeight}},getTask:function(a){var b;return b=a.attr(this.options.attributeName),this.tasks[b]?this.tasks[b]:!1},_create:function(){return this._browser_is_supported()&&this._dependencies_resolved()?(this.kbnId=this.element.attr(this.options.attributeName),this.dropAreas={},this.tasks={},this.scope="project_kanban_"+this.kbnId,this.offset=this.element.offset(),this._setup()):!1},_setOption:function(a,b){return this.options[a]=b,this._super(a,b),this.update()},_setup:function(){return this._initDrops(),this._initTasks(),this._initResizable(),this._trigger(":ready",this)},_initResizable:function(){return this.element.resizable({handles:"s",minHeight:400,create:function(a){return function(){var b,c,d;c=a._restoreHeight(),a.element.css("height",c+"px"),d=[];for(b in a.drops)d.push(b.setHeight(c));return d}}(this),stop:function(a){return function(){var b,c;c=a.element.height();for(b in a.drops)b.setHeight(c);return a._storeHeight(c)}}(this)})},isDroppable:function(a){return("function"==typeof a.hasClass?a.hasClass(this.options.drops.slice(1)):void 0)?!0:!1},_storeResizeKey:function(){return this.storagePrefix+"project_"+this.knbId},_initDrops:function(){return this.element.find(this.options.drops).each(function(a){return function(b,d){var e;return e=c(d),a.addDrop(e)}}(this))},_initTasks:function(){return this.element.find(this.options.tasks).each(function(a){return function(b,d){var e;return e=c(d),a.addTask(e)}}(this))},update:function(){return this.render()},addDrop:function(b){return this.dropAreas[b.attr(this.options.attributeName)]=new a(b,this),this._trigger(":dropadd",this,this.dropAreas[b.attr(this.options.attributeName)])},addTask:function(a){var c;return c=new b(a,this),this.tasks[a.attr(this.options.attributeName)]=c,this._trigger(":taskadd",this,this.tasks[a.attr(this.options.attributeName)]),c.initialize()},render:function(){var a,b;a=[];for(b in this.tasks)a.push(b.render());return a},_browser_is_supported:function(){return"Microsoft Internet Explorer"===window.navigator.appName?document.documentMode>=8:/iP(od|hone)/i.test(window.navigator.userAgent)?!1:/Android/i.test(window.navigator.userAgent)&&/Mobile/i.test(window.navigator.userAgent)?!1:!0},_dependencies_resolved:function(){return null==c().draggable?!1:null==c().droppable?!1:!0}})}(jQuery)}).call(this);