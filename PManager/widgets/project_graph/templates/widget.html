{% load floattags jsonify humanize compressed %}
{% compressed_js 'project_graph' %}
<style>
    .project_graph .well .role-titles h5:not(.active) {
        display: none;
    }
</style>
<script>
    $(function() {
        $('.js-select-role').click(function(){
            if (!$(this).is('.active')) {
                $(this).addClass('active').siblings('.js-select-role').removeClass('active');
                $('.js-role').filter('[data-role='+$(this).data('role')+']').show().siblings('.js-role').hide();
            }
        });
        $('.js-change-role').click(function(){
            var $next = $('.js-select-role.active').next('.js-select-role');
            var $first = $('.js-select-role').not('.active').eq(0);
            if ($next.get(0)) {
                $next.trigger('click');
            } else {
                $first.trigger('click')
            }
            return false;
        });
    })
</script>
<div class="row project_graph">
    {% if project_graph.roles %}
    <div class="col-sm-3">
        <div class="well hide-on-mobile">
            <div class="role-titles">
                {% for role in project_graph.roles %}
                        <h5 class="{% if forloop.first %}active{% endif %} js-select-role" data-role="{{ role.role.code }}">
                            Роль: {{ role.role.name }}
                        </h5>
                {% endfor %}
                {% if project_graph.roles|length > 1 %}
                    <a href="#" class="js-change-role"><i class="fa fa-chevron-right"></i> </a>
                {% endif %}
            </div>
            {% for role in project_graph.roles %}
                <div class="role-{{ role.role.code }} js-role" data-role="{{ role.role.code }}" {% if not forloop.first %}style="display: none;" {% endif %}>

                    <div class="role-content">
                        <div class="role-content-tab">
                            <strong>Цена часа:</strong> &nbsp;<span class="stavka {% if project_graph.rating < 0 %}danger{% else %}success{% endif %}">{{ role.rate }}
                             {% if role.rate %}
                                <span class="bonus">{% if project_graph.rating < 0 %}{% else %}
                                +{% endif %}{{ project_graph.rating }}
                                </span>
                             {% else %}&nbsp;
                             {% endif %}
                            </span>
                            <br /><span style="text-transform: lowercase">{{ role.bet_type_name }}</span> <a href="/wiki/bonuses">?</a>
                        </div>
                    </div>
                </div>
            {% endfor %}
        </div>
    </div>
    {% endif %}
    <div class="col-sm-{% if project_graph.roles %}9{% else %}12{% endif %}">
        <div class="well hide-on-mobile" style="border-left-color: #fe781e;">
            <div class="row">
                    <div class="col-xs-2" >
                        <h5>Счет <a href="/wiki/bonuses">?</a></h5>
                        <span style="white-space: nowrap;"><strong>Всего:</strong> <b style="color:#fe781e;font-size:18px;">{{ project_graph.allPrice|intcomma }}</b></span><br>
                        <span style="white-space: nowrap;"><strong>По проекту:</strong> <b style="color:#fe781e;">{{ project_graph.allProjectPrice|intcomma }}</b></span>
                    </div>

                    <div class="col-xs-7" style="border-left: 1px solid #efefef;">
                        <h5>Прогресс</h5>
                        {% if project_graph.closestMilestone %}
                            Ближайшая цель: <b style="color:#{% if project_graph.closestMilestone.wouldOverdue %}d9534f{% else %}fe781e{% endif %};">{{ project_graph.closestMilestone.name }}</b> до <b style="color:#{% if project_graph.closestMilestone.wouldOverdue %}d9534f{% else %}fe781e{% endif %};">{{ project_graph.closestMilestone.date|date:"d.m.Y" }}</b>
                            <div class="progress">
                                <div class="progress-bar progress-bar-info" role="progressbar"
                                     aria-valuenow="{{ project_graph.closestMilestone.taskClosedPercent }}" aria-valuemin="0"
                                     aria-valuemax="100" style="width: {{ project_graph.closestMilestone.taskClosedPercent }}%;
                                        background-color: #{% if project_graph.closestMilestone.wouldOverdue %}d9534f{% else %}5cb85c{% endif %};">
                                    <span class="sr-only">{{ project_graph.closestMilestone.taskClosedPercent }}% Complete</span>
                                </div>
                            </div>
                        {% else %}
                            Закрыто задач: <b style="color:#fe781e;">{{ project_graph.closedTasksQty }}</b> из <b style="color:#fe781e;">{{ project_graph.tasksQty }}</b>
                            <div class="progress">
                                <div class="progress-bar progress-bar-info" role="progressbar"
                                     aria-valuenow="{{ project_graph.taskClosedPercent }}" aria-valuemin="0"
                                     aria-valuemax="100" style="width: {{ project_graph.taskClosedPercent }}%;background-color: #5cb85c;">
                                    <span class="sr-only">{{ project_graph.taskClosedPercent }}% Complete</span>
                                </div>
                            </div>
                        {% endif %}
                    </div>
                    <div class="col-xs-3" style="border-left: 1px solid #efefef;">
                        {% if project_graph.roles and project_graph.isEmployee %}
                            <h5>Место: <b style="color:#fe781e;">{{ project_graph.taskTagPosition }}</b></h5>
                        {% else %}
                            <h5>Рейтинг</h5>
                        {% endif %}
                        Закрыто задач: <b style="color:#fe781e;">{{ project_graph.allTaskQty }}</b><br>
                        Компетентность: <b style="color:#fe781e;">{{ project_graph.taskTagCoefficient }}</b>

                    </div>
                    <div class="clr"></div>
            </div>
        </div>
    </div>
</div>