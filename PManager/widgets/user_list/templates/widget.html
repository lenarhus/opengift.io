{% load compressed %}
{% compressed_js 'user_list' %}
<script>
$(function() {
		$('body').tooltip({
			selector: "[rel=tooltip]", // можете использовать любой селектор
			placement: "top" 
		});
	});
</script>
<div class="widget">
    <div class="widget-control">
        <a href="#" class="w-close">Закрыть</a>
    </div>

    <h3>Все пользователи</h3>
    <hr>
    
    <div class="row-fluid user-list-filer" style="display: none;">
    	<div class="span4">
        <select class="form-control">
          <option>Выберите проект</option>
          {% for p in projects %}
          <option {% if p.id == user_list.currentProject %}selected{% endif %} value="{{ p.id }}">{{ p.name }}</option>
          {% endfor %}
        </select>
        </div>
    	<div class="span4">
        <input type="text" placeholder="Введите имя" class="form-control"/>
        </div>
    	<div class="span4">
        <select class="form-control">
          <option>Выберите роль в проекте</option>
          <option>Разработчик</option>
          <option>Клиент</option>
          <option>Менеджер</option>
        </select>
        </div>
        <hr />
    </div>
    
    <div class="row-fluid user-list">
        <div class="container-fluid">
            {% for user in user_list.users %}
                <div class="user-block widget inner js-user span4" data-id="{{ user.id }}">
                	<div class="widget-title clearfix">
                    	<div class="pull-left"><i class="statusImg"></i>&nbsp;&nbsp;
                            <a href="/user_detail/?id={{ user.id }}"><b>{% if user.last_name %}{{ user.last_name }} {{ user.first_name }}{% else %}{{ user.username }}{% endif %}</b></a>
                            {% if user.get_profile.is_outsource %}
                            <span class="pro-icon" href="/pro/" style="top:-2px;left: 4px;">
                                <i class="fa fa-star"></i>
                            </span>
                            {% endif %}
                            <small class="small">
                                {% if user.profile.specialties.count %}
                                    {% for spec in user.profile.specialties.all %}{% if not forloop.first %}, {% endif %}{{ spec.name }}{% endfor %}
                                {% else %}
                                    {% for role in user.roles_in_projects %}{% if forloop.first %}{{ role }}{% endif %}{% endfor %}
                                {% endif %}
                            </small>

                        </div>
                            {% if user.user_achievements.count %}
                            <span class="achievement-ico">{{ user.user_achievements.count }}</span>
                            {% endif %}
                    </div>

                    <div class="widget-body user-personal row-fluid clearfix">
                        <table width="100%" cellpadding="0" cellspacing="0" class="user">
                            <tr>
                                <td class="avatar">
                                    <a href="/user_detail/?id={{ user.id }}">
                                        <span>
                                        {% if user.profile.avatarSrc %}
                                        <img src="{{ user.profile.avatarSrc }}"
                                             alt="{{ user.last_name }} {{ user.first_name }}"/>
                                        {% else %}
                                        <script>document.write($.createAvatar({
                                            'id': {{ user.id }},
                                            'initials': {% if user.last_name %}'{{ user.last_name }}'[0] + '{{ user.first_name }}'[0]{% else %}''{% endif %},
                                            'color': '{{ user.profile.avatar_color }}'
                                        }));</script>
                                        {% endif %}
                                        </span>
                                    </a>
                                </td>
                                <td class="about-user">
                                {% if is_admin %}
                                    <a href="mailto:{{ user.email }}"><i
                                            class="fa fa-envelope"></i>&nbsp;&nbsp;{{ user.email }}</a>
                                {% endif %}
                                    <hr/>
                                    Закрыто задач за месяц: <b>{{ user.tasksQty }} ({{ user.tasksEffective }})</b>
                                    {% if user.last_login %}<br />Зашел {{ user.last_login|date:"d.m.Y h:i:s" }}{% endif %}
                                    {% if user.startedTask %}
                                        <hr>
                                        <a class="startedTask" rel="tooltip" href="{{ user.startedTask.url }}"
                                              {% if user.bHaveAccessToStartedTask %}
                                              data-original-title="{{ user.startedTask.project.name }}: {{ user.startedTask.name }}"
                                              {% endif %}>Занят</a>
                                    {% endif %}
                                    {% if is_admin %}
                                         <b>Счет: {{ user.profile.account_total }}</b><br />
                                        <a href="?auth={{ user.id }}">Авторизоваться</a>
                                    {% endif %}
                                </td>
                            </tr>
                        </table>
                    </div>
                                        
                </div>
            {% endfor %}
        </div>
    </div>
</div>
<style>
    .user-block.pro {
        border: 2px solid #aa7729;
        border-radius: 6px;
    }
</style>