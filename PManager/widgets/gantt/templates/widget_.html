{% load arraytags jsonify %}
<script type="text/javascript" src="/static/js/libs/timepicker/jquery.timepicker.js"></script>
<link rel="stylesheet" type="text/css" href="/static/js/libs/timepicker/jquery.timepicker.css" />
<script type="text/javascript" src="/static/js/libs/timepicker/base.js"></script>
<link rel="stylesheet" type="text/css" href="/static/js/libs/timepicker/base.css" />

<div class="modal fade" id="new-milestone" tabindex="-1" role="dialog" aria-labelledby="myModalLabel" aria-hidden="true">
  <div class="modal-dialog">
    <div class="modal-content">
      <div class="modal-header">
        <button type="button" class="close" data-dismiss="modal" aria-hidden="true">&times;</button>
        <h2 class="modal-title" id="myModalLabel">Создание майлстоуна</h2>
      </div>
      <form role="form" class="js-milestone-form" method="post">
      <div class="modal-body">
          <div class="form-group">
            <input type="text" name="milestone-name" class="form-control" placeholder="Введите название">
          </div>
          
          <div class="form-group choose-date">
          	<input type="text" value="" name="milestone-date" placeholder="Формат даты дд.мм.ггг" class="form-control"> <a href="#" onclick="$(this).prev().focus();" class="fa fa-calendar"></a>
          </div>
{#          <div class="btn-group">#}
{#              <a onclick="$(this).next().toggle();return false;" href="#">Выбрать задачу&nbsp;<span class="caret"></span></a>#}
{#              <ul role="menu" class="dropdown-menu choose-task-popup">#}
{#                <li><input type="text"  placeholder="Введите название задачи" class="form-control"/></li>#}
{#                <li>#}
{#                    <div class="overflow-y">#}
{#                        <div class="checkbox"><label><input type="checkbox">Название задачи</label></div>#}
{#                        <div class="checkbox"><label><input type="checkbox">Название задачи 2</label></div>#}
{#                        <div class="checkbox"><label><input type="checkbox">Название задачи 3</label></div>#}
{#                        <div class="checkbox"><label><input type="checkbox">Название задачи 4</label></div>#}
{#                        <div class="checkbox"><label><input type="checkbox">Название задачи 5</label></div>#}
{#                        <div class="checkbox"><label><input type="checkbox">Название задачи 6</label></div>#}
{#                        <div class="checkbox"><label><input type="checkbox">Название задачи 7</label></div>#}
{#                    </div>#}
{#                </li>#}
{#                <li class="divider"></li>#}
{#                <li><a class="btn btn-success" href="#">Выбрать</a></li>#}
{#              </ul>#}
{#          </div>#}
      </div>
      <div class="modal-footer">
        <input type="submit" name="create-milestone" class="btn btn-success js-create-milestone" value="Создать" />
        <button type="button" class="btn btn-default" data-dismiss="modal">Закрыть</button>
      </div>
      </form>
    </div>
  </div>
</div>

<div class="widget gantt" style="overflow:hidden;height:210px;">
<div class="widget-control"> <a href="#" class="w-collapse">Свернуть</a> <a href="#" class="w-close">Закрыть</a> </div>
<h3>Календарный план</h3>
<hr>

<div class="row-fluid">

{#    <div class="btn-toolbar">#}
{#        <div class="btn-group">#}
{#            <a class="btn btn-inverse" href="#"><i class="icon-random icon-white"></i></a>#}
{#            <a class="btn btn-inverse" href="#"><i class="icon-align-left icon-white"></i></a>#}
{#        </div>#}
{#    </div>#}

    <div class="tasks-and-deals-control-buttons">
        <p><a href="#" class="btn btn-success" data-toggle="modal" data-target="#new-milestone">Создать майлстоун</a></p>
        <a href="#" class="btn zoom_out"><i class="fa fa-minus-square-o"></i></a>
        <a href="#" class="btn zoom_in"><i class="fa fa-plus-square-o"></i></a>
        <a href="#" class="js-goToNow">Сегодня</a>
    </div>

    <div style=" height: 95px; margin: 0 160px 0 10px;overflow: hidden;position: relative;">
    <div class="diagramma" style="margin:0px !important;">
        <div class="diagramma-l"></div>

        <div class="scroll-bar">
            <span class="scroll-bar-left"></span>
            <span class="scroll-bar-right"></span>
        </div>

        <div class="dates-subtasks" >
            <div class="progress">
                <div class="bar" style="width: 500px;"></div>
            </div>
            <div class="dates-bar" >

            </div><!--dates-bar-->
            <div class="planlet-container">

            </div><!--plantlet-container-->
        </div>

        <div class="diagramma-r"></div>
    </div>
    </div>
    
    
    <div class="row-fluid calendar-bar-tools">
{#    <div class="pull-left">#}
{#        <div class="btn-toolbar">#}
{#            <div class="btn-group"> <a class="btn" href="#"><i class="icon-align-left"></i></a> <a class="btn" href="#"><i class="icon-align-center"></i></a> <a class="btn" href="#"><i class="icon-align-right"></i></a> <a class="btn active" href="#"><i class="icon-align-justify"></i></a> </div>#}
{#        </div>#}
{#    </div>#}
    <!--pull-left-->
    <div class="pull-right">
    	<a onclick="var $a=$('.widget.gantt');if ($(this).parent().hasClass('active')) {$a.css('height','210px');} else {$a.css('height','auto');}$(this).parent().toggleClass('active');return false;" href="#" class="btn btn-primary">Детально</a>
{#      <ul class="nav nav-pills">#}
{#            <li><a onclick="var $a=$('.widget.gantt');if ($(this).parent().hasClass('active')) {$a.css('height','210px');} else {$a.css('height','auto');}$(this).parent().toggleClass('active');return false;" href="#" class="btn btn-primary">Детально</a></li>#}
{#            <li class="active"><a href="#">Реально</a></li>#}
{#            <li><a href="#">Смешать</a></li>#}
{#        </ul>#}
    </div>
    <!--pull-right-->
</div>
<!--calendar-bar-tools-->


    
</div>

<div class="filter-hidden hidden">
    <div class="row-fluid">
        <hr>
        <ul class="nav nav-pills">
            <li><a href="#">Входящие</a></li>
            <li class="active"><a href="#">Исходящие</a></li>
            <li><a href="#">Горящие</a></li>
            <li><a href="#">Избранные</a></li>
        </ul>
    </div>
    <div class="form-with-inputs">
        <div class="row-fluid"> <span class="help-inline">Ответственный</span>&nbsp;&nbsp;
            <input type="text">
        </div>
        <div class="row-fluid"> <span class="help-inline">дата с</span>&nbsp;&nbsp;
            <input type="text" class="input-mini">
            &nbsp;&nbsp;<a href="#" class="fa fa-calendar"></a> <span class="help-inline">по</span>&nbsp;&nbsp;
            <input type="text" class="input-mini">
            &nbsp;&nbsp;<a href="#" class="fa fa-calendar"></a> </div>
        <div class="row-fluid"> <span class="help-inline">Ключевые слова</span>&nbsp;&nbsp;
            <input type="text">
        </div>
    </div>
    <p class="text-center"><a href="#" class="btn btn-mini">Свернуть фильтр&nbsp;&nbsp;<i class="fa fa-caret-square-o-up"></i></a></p>
    <hr>
</div>
<!--filter-hidden-->
<table width="100%" cellpadding="0" cellspacing="0" class="table-graph-task-details">
<tr>
<td valign="top" width="70%">
	<div class="calendar-bar-wrapper" style="position:relative;">
    
    <div class="js-gantt-task-detail task-details popup-task" style="display:none; position:absolute; right:26px; top:40px; box-shadow:0 0 10px #AAAAAA; width:400px; z-index:1;">
     
      <div class="row-fluid">
{#      	<div class="control-section clearfix">#}
{#            <div class="pull-left js-date-create"></div>#}
{#            #}
{#            <div class="task-manage pull-right">#}
{#                <a class="js-task_done  fa fa-check" href="javascript:void(0);"></a>#}
{#                <span class="dropdown pull-right close-task-wrapper">#}
{#                    <a class="js-task_play task_play started" href="javascript:void(0);"><span class="fa fa-pause"></span></a>#}
{#                    <div class="dropdown-menu pull-right pause_dialog">#}
{#                        <h3>Введите комментарий</h3>#}
{#                        <textarea class="form-control" name="comment"></textarea>#}
{#                        <a class="btn btn-success pause_comment_success">Ок</a>#}
{#                        <a class="btn btn-danger pause_comment_cancel">Отменить таймер</a>#}
{#                    </div>#}
{#                </span>#}
{#                <span class="dropdown pull-right js-options_popup">#}
{#                    <a class="fa fa-plus-circle js-task_menu" href="javascript:void(0);" data-toggle="dropdown"></a>#}
{#                </span>#}
{#            </div>#}
{#        </div>#}
        
        <div class="clearfix"></div>
      	
        <h3 class="bottom-border-style"><a class="js-title" href=""></a></h3>
        <b><a href="/user_datail/?id=2" class="js-author"></a></b>
        
      
      </div><!--row-fluid-->
      
        <div class="row-fluid">
            <div class="bottom-border-style">
                <p class="js-description bottom-border-style"></p>
                 
                <div class="task-author">
                    <p class="bottom-border-style"><b>Ответственный</b><br>
                    <span class="js-responsible"></span></p>
                    
                    <p class="bottom-border-style"><b>Дата окончания</b>: <span class="js-end-date"></span></p>
{#                    <p class="more-about-task">Еще какая-то инфа про задачу</p>#}
                </div>                
            </div>
            
            <div class="last-message js-last-message">
                	<h5>Последнее сообщение: </h5>
                	<hr>
                    <p class="last-message-info">
                    	<b><a href="#" class="js-last-message-author"></a>:</b><br>
                        <small class="js-last-message-date"></small>
                    </p>
                    <p class="js-last-message-text"></p>
            </div>
            
        </div><!--row-fluid-->
        <hr />
        <a class="btn btn-danger" href="javascript: void(0);" onclick="$(this).closest('.js-gantt-task-detail').hide();" style="width:100%; color:#fff;">Закрыть</a>
        
    </div><!--task-details-->
    
    <div class="row-fluid" id="gantt_timeline_date_top" style="height:50px;">

    </div>
    <div class="row-fluid calendar-bar" id="gantt_timeline">

    </div>
    <div class="row-fluid" id="gantt_timeline_date_bottom" style="height:50px;">

    </div>
    
    </div><!--calendar-bar-wrapper-->
    <!--calendar-bar-->
</td>

</tr>
</table>
</div>

{#<script type="text/javascript" src="/static/js/libs/raphael-min.js"></script>#}
{#<script type="text/javascript" src="/static/js/pm/timeline.js"></script>#}
<script type="text/javascript" src="/widgets/js/gantt/script.js"></script>
<link rel="stylesheet" type="text/css" href="/static/css/external/chronoline.css" />
<script>
var timeline = false;
var GANTT_TASKS = [
        {% for task in gantt.tasks %}
            {% if task.endTime|date:"Y" %}
            {dates: [
                new Date({{ task.dateCreateGantt|date:"Y" }}, ({{ task.dateCreateGantt|date:"m" }}*1-1), {{ task.dateCreateGantt|date:"d" }}, {{ task.dateCreateGantt|date:"H" }}, {{ task.dateCreateGantt|date:"i" }}, {{ task.dateCreateGantt|date:"s" }}),
                new Date({{ task.endTime|date:"Y" }}, ({{ task.endTime|date:"m" }}*1-1), {{ task.endTime|date:"d" }}, {{ task.endTime|date:"H" }}, {{ task.endTime|date:"i" }}, {{ task.endTime|date:"s" }})],
                title: {{ task.name|jsonify|safe }},
                url: {{ task.url|jsonify|safe }},
                author: "{{ task.author.first_name }} {{ task.author.last_name }}",
                date_create: "{{ task.dateCreate }}",
                responsibles: "<a href='#'>{% for resp in task.responsible %}{{ resp.name }}{% if not forloop.last %}, {% endif %}{% endfor %}</a>",
                description: {{ task.text|jsonify|safe }},
                section: 1,
                responsible:"{% for resp in task.responsible %}{{ resp.name }}{% if not forloop.last %}, {% endif %}{% endfor %}",
                closed: {{ task.closed|yesno:"true,false" }},
                id: {{ task.id }},
                attrs: {fill: "{% if task.closed %}#aaaaaa{% else %}#0094df{% endif %}",stroke:"{% if task.closed %}#aaaaaa{% else %}#0094df{% endif %}"},
                lastMessage: {
                    author: {{ task.last_message.author|jsonify|safe }},
                    text: {{ task.last_message.text|jsonify|safe }}
                },
                timers: [
                    {% for timer in task.timers %}
                        {
                            date_start: new Date({{ timer.dateStart|date:"Y" }}, ({{ timer.dateStart|date:"m" }}*1-1), {{ timer.dateStart|date:"d" }}, {{ timer.dateStart|date:"H" }}, {{ timer.dateStart|date:"i" }}, {{ timer.dateStart|date:"s" }})
                            {% if timer.dateEnd != 'now'  %},
                            date_stop: new Date({{ timer.dateEnd|date:"Y" }}, ({{ timer.dateEnd|date:"m" }}*1-1), {{ timer.dateEnd|date:"d" }}, {{ timer.dateEnd|date:"H" }}, {{ timer.dateEnd|date:"i" }}, {{ timer.dateEnd|date:"s" }})
                            {% endif %}
                        }{% if not forloop.last %},{% endif %}
                    {% endfor %}
                ]
            }{% if not forloop.last %},{% endif %}
            {% endif %}
        {% endfor %}
    ];
    $(function(){
        var sections2 = [
{#            {dates: [new Date(2011, 2, 31), new Date(2013, 9, 28)], title: "Веха 1", section: 1, attrs: {fill: "#e3f0fe"}},#}
{#            {dates: [new Date(2012, 2, 28), new Date(2012, 9, 3)], title: "2012 MLB Regular Season", section: 1, attrs: {fill: "#e3f0fe"}},#}
{#            {dates: [new Date(2012, 1, 29), new Date(2012, 3, 4)], title: "Spring Training", section: 2, attrs: {fill: "#cce5ff"}},#}
{#            {dates: [new Date(2012, 9, 4), new Date(2012, 9, 31)], title: "2012 MLB Playoffs", section: 3, attrs: {fill: "#cce5ff"}}#}
        ];

        $('.zoom_in').click(function(){
            timeline.zoomIn();
            return false;
        });

        $('.zoom_out').click(function(){
            timeline.zoomOut();
            return false;
        });

        $('#gantt_timeline, #gantt_timeline_date_bottom, #gantt_timeline_date_top')
                .css({'width':$('#gantt_timeline').parent().width()});
    });
</script>
<div class="progress-task-desc hidden">
    <img class="hidden" src="" width="100">
    <h5></h5>
    <p class="d-task-desc"></p>
    <div class="clr"></div>
    <p class="text-right"><a href="#">Перейти...</a></p>
</div>
<script>
    hoverOnHint = false;
    hintTimeout = false;
    $(function(){
        $('.progress-task-desc').hover(function(){hoverOnHint=true;},function(){hoverOnHint=false;})
        $("input[name='milestone-date']").datepicker({
           'weekStart':1,
           'format': 'dd.mm.yyyy',
           'autoclose':true
       });
    });
</script>