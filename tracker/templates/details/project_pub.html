{% extends "public/index.html" %}
{% load thumbnail get_settings compressed %}
{% block content %}
    {% compressed_css 'project_detail' %}
    <style>
        .small-text-label {
            padding: 3px 7px;
            font-size: 11px !important;
        }
    </style>
    <section class="u-py-100 relative u-h-100vh u-flex-center quadro-relative" style="
	background: #62bb94;
	background-image: -webkit-linear-gradient(left, #38c1d1 0%, #62bb94 100%);
	background-image: -o-linear-gradient(left, #38c1d1 0%, #62bb94 100%);
	background-image: -webkit-gradient(linear, left top, right top, from(#38c1d1), to(#62bb94));
	background-image: linear-gradient(to right, #38c1d1 0%, #62bb94 100%);
	background-repeat: repeat-x;
	filter: progid:DXImageTransform.Microsoft.gradient(startColorstr='#FF38c1d1', endColorstr='#FF62bb94', GradientType=1);
 ">
         <div class="container">
            <div class="row">
                <div class="col-lg-{% if project.files.count %}6{% else %}12 text-center{% endif %} u-mt-80">
                    <div class="project-rate clearfix">
                        <div class="project-stars pull-left">
                            <a href="#" data-rating="1"
                               class="js-project-rating-star fa fa-star{% if rating < 1 %}-o{% endif %}"></a>
                            <a href="#" data-rating="2"
                               class="js-project-rating-star fa fa-star{% if rating < 2 %}-o{% endif %}"></a>
                            <a href="#" data-rating="3"
                               class="js-project-rating-star fa fa-star{% if rating < 3 %}-o{% endif %}"></a>
                            <a href="#" data-rating="4"
                               class="js-project-rating-star fa fa-star{% if rating < 4 %}-o{% endif %}"></a>
                            <a href="#" data-rating="5"
                               class="js-project-rating-star fa fa-star{% if rating < 4.8 %}-o{% endif %}"></a>
                        </div>
                        {% if not user_voted %}
                            <script>
                                $(function () {
                                    var userVoted = false;
                                    var star = '.js-project-rating-star';
                                    $(star).hover(
                                            function () {
                                                if (!userVoted) {
                                                    var vote = true, t = this;
                                                    $(star).each(function () {
                                                        if (vote) {
                                                            $(this).addClass('fa-star').removeClass('fa-star-o');
                                                            if ($(t).data('rating') == $(this).data('rating')) {
                                                                vote = false;
                                                            }
                                                        } else {
                                                            $(this).removeClass('fa-star').addClass('fa-star-o');
                                                        }
                                                    });
                                                }
                                            },
                                            function () {
                                                if (!userVoted) {
                                                    $(star).removeClass('fa-star').addClass('fa-star-o');
                                                }
                                            }
                                    ).click(function () {
                                        if (!userVoted) {
                                            $.post(
                                                    '/project/{{ project.id }}/ajax/',
                                                    {
                                                        'action': 'rate',
                                                        'rating': $(this).data('rating')
                                                    },
                                                    function (data) {

                                                    },
                                                    'json'
                                            );
                                            userVoted = true;
                                            var vc = '.js-voters-count';
                                            $(vc).text(parseInt($(vc).text()) + 1);
                                        }
                                        return false;
                                    });
                                })
                            </script>
                        {% endif %}
                        <div class="pull-left project-rate-separator"><i class="fa fa-circle"></i></div>
                        <div class="project-voices pull-left"><span class="js-voters-count">{{ raters_count }}</span>
                            votes
                        </div>
                    </div>
                    <h1 class="display-4 u-fw-600 text-white u-mb-40">
                        {{ project.name }}{% if bCurUserIsAuthor %}&nbsp;<a style="font-size: 30%;" href="/project/{{ project.id }}/edit/" class="fa fa-edit text-small"></a>{% endif %}
                        {% if not long_industries_list %}
                            {% for tag in tags %}
                                <sup class="small-text-label btn-red btn btn-sm btn-rounded">{{ tag.name }}</sup>
                            {% endfor %}
                        {% endif %}
                    </h1>
                    {% if long_industries_list %}
                        {% for tag in tags %}
                            <sup class="small-text-label btn-yellow btn btn-sm btn-rounded">{{ tag.name }}</sup>
                        {% endfor %}
                    {% endif %}


                    <p class="u-fs-22 text-white u-lh-1_8 u-mb-40">
                        {{ project.description }}
                    </p>
                    {% if project.link_demo %}
                    <a href="{{ project.link_demo }}" class="btn btn btn-rounded btn-white px-md-5">
                        View Demo
                    </a>
                    {% endif %}
                    <a href="/project/{{ project.id }}/donate/" class="btn btn btn-rounded btn-primary ml-3 px-md-5">
                        Become a Sponsor
                    </a>
                </div> <!-- END col-lg-6-->
                {% if project.files.count %}
                <div class="col-lg-6 u-mt-80">

                    <ul class="p-0" data-init="carousel"
                        data-slick='{ "slidesToShow":1, "dots":true, "arrows":false, "dotsClass":"slick-dots dots-white mt-4 text-center"}'>
                        {% for file in project.files.all %}
                            {% if file.isPicture %}
                                <li>
                                    <img class="box-shadow-v1" src="{{ file.src }}" alt=""/>
                                </li>
                            {% endif %}
                        {% endfor %}
                    </ul>

                </div> <!-- END col-lg-6-->
                {% endif %}
            </div> <!-- END row-->
        </div> <!-- END container-->
    </section> <!-- END intro-hero-->




    <section class="u-py-100 with-waves" style="padding-bottom: 0 !important; padding-top: 50px !important;">
        <svg width="100%" height="100%" version="1.1" xmlns="http://www.w3.org/2000/svg" class="wave wave-4"
             style="position: absolute;"><title>Wave</title>
            <defs></defs>
            <path id="feel-the-wave-four" d=""/>
        </svg>
        <div class="container">
            <div class="row text-center">

                <div class="col-lg-3 col-md-6 u-my-20">
                    <div class="box-shadow-v1 u-ff-dosis u-py-40 rounded bg-gray-v1"
                         style="background: #a456fd; color: #fff !important;">
                        <h4 class="mb-0 u-fs-36 u-fw-400" style="color: #fff !important;">
                            {{ hours_spent }}
                        </h4>

                        <p class="u-fs-20">
                            Hours spent
                        </p>
                    </div>
                </div> <!-- END col-lg-3 col-md-6-->

                <div class="col-lg-3 col-md-6 u-my-20">
                    <div class="box-shadow-v1 u-ff-dosis u-py-40 rounded bg-gray-v1"
                         style="background: #ff7298; color: #fff !important;">
                        <h4 class="mb-0 u-fs-36 u-fw-400" style="color: #fff !important;">
                            {{ project.projectTasks.count }}
                        </h4>

                        <p class="u-fs-20">
                            Things done
                        </p>
                    </div>
                </div> <!-- END col-lg-3 col-md-6-->

                <div class="col-lg-3 col-md-6 u-my-20">
                    <div class="box-shadow-v1 u-ff-dosis u-py-40 rounded"
                         style="background: #5eabff; color: #fff !important;">
                        <h4 class="mb-0 u-fs-36 u-fw-400" style="color: #fff !important;">
                            14 304
                        </h4>

                        <p class="u-fs-20">
                            Registrations/Downloads
                        </p>
                    </div>
                </div> <!-- END col-lg-3 col-md-6-->

                <div class="col-lg-3 col-md-6 u-my-20">
                    <div class="box-shadow-v1 u-ff-dosis u-py-40 rounded bg-gray-v1"
                         style="background: #ffb976; color: #fff !important;">
                        <h4 class="mb-0 u-fs-36 u-fw-400" style="color: #fff !important;">
                            {{ donationsCount }}
                        </h4>

                        <p class="u-fs-20">
                            Donates recd
                        </p>
                    </div>
                </div> <!-- END col-lg-3 col-md-6-->

            </div> <!-- END row-->
        </div> <!-- END container-->
    </section>

    <section class="u-py-100" style="padding-bottom: 0 !important;">
        <section class="u-py-100 bg-gray-v1">
            <div style="padding: 0 6.25rem;">
                <div class="row">
                    <div class="col-lg-6 m-auto text-center">
                        <h2 class="h1">
                            Project's pulse
                        </h2>

                        <div class="u-h-4 u-w-50 bg-primary rounded mt-4 u-mb-40 mx-auto"></div>
                    </div>
                </div>
                <div class="row">
                    {% for chart in statistic.charts %}
                        <div class="col-md-3 mt-3" style="margin-bottom: 30px;">
                            <div class="card border-0 box-shadow-v1 u-h-100p">
                                <div class="u-p-30">
                                    <h4 class="text-center">{{ chart.title }}</h4>
                                    <canvas id="chart_{{ forloop.counter }}" width="400" height="400"></canvas>
                                </div>
                            </div>
                        </div>
                    {% endfor %}
                </div>
            </div>
        </section>

        <section>
            <div class="container">
                <div class="row">

                    <div class="col-12 text-center">
                        <h2 class="h1">
                            Team
                        </h2>

                        <div class="u-h-4 u-w-50 bg-primary rounded mx-auto mt-4 mb-5"></div>
                    </div> <!-- END col-12-->
                </div> <!-- END row-->


                <div class="align-items-center">
                    <div data-init="carousel" data-slick='{
				"slidesToShow":3,
				"slidesToScroll": 1,
				"arrows":true,
				"prevArrow":"<div class=\"slick-prev box-shadow-v1\"><i class=\"fa fa-angle-left\"></i></div>",
				"nextArrow":"<div class=\"slick-next box-shadow-v1\"><i class=\"fa fa-angle-right\"></i></div>",
				"responsive": [
						{
						 "breakpoint":1024,
						 "settings":{
							"slidesToShow": 2,
							"arrows":true,
							"dots":true,
							"dotsClass":"slick-dots dots-white mt-4 text-center"
						 }
						},
						{
						 "breakpoint":600,
						 "settings":{
							"slidesToShow": 1,
							"arrows":false,
							"dots":true,
							"dotsClass":"slick-dots dots-white mt-4 text-center"
						 }
						}
					]
				}'
                         data-slick-margin="30">


                        {% for user in team %}
                            {% if user.get_profile.avatarSrc %}
                                <div class="rounded bg-white text-center">
                                    <div class="rounded-circle u-w-90-wrapper mb-4"
                                         style="background: url('{{ user.get_profile.avatarSrc }}');">
                                    </div>

                                    <h4 class="u-mb-5">
                                        {{ user.first_name }} {{ user.last_name }}
                                        <div class="user-rating">
                                            <i class="fa fa-star"></i> {{ user.rating|floatformat }}
                                        </div>
                                    </h4>

                                    <p>
                                        {% for spec in user.get_profile.specialties.all %}<span>{{ spec.name }}</span>
                                            {% if not forloop.last %}, {% endif %}{% endfor %}
                                    </p>
                                    <ul class="list-inline social social-rounded social-default social-sm mt-4">
                                        <li class="list-inline-item">
                                            <a href=""><i class="fa fa-facebook"></i></a>
                                        </li>
                                        <li class="list-inline-item">
                                            <a href=""><i class="fa fa-twitter"></i></a>
                                        </li>
                                        <li class="list-inline-item">
                                            <a href=""><i class="fa fa-google-plus"></i></a>
                                        </li>
                                        <li class="list-inline-item">
                                            <a href=""><i class="fa fa-linkedin"></i></a>
                                        </li>
                                    </ul>
                                </div>
                            {% endif %}
                        {% endfor %}
                    </div>

                </div> <!-- END row-->
            </div> <!-- END container-->
        </section>

        <script>
            $(function () {
                {% for chart in statistic.charts %}
                    var ctx = document.getElementById("chart_{{ forloop.counter }}").getContext('2d');
                    var mixedChart = new Chart(ctx, {
                        type: 'bar',

                        data: {
                            labels: [{% for event in chart.xAxe %}'{{ event.date|date:"m" }}'{% if not forloop.last %}, {% endif %}{% endfor %}],
                            datasets: [
                                {% for y, axis in chart.yAxes.iteritems %}
                                    {
                                        label: "{{ axis.title }}",
                                        {% if forloop.last %}backgroundColor: "{{ axis.color }}",{% endif %}
                                        borderColor: "{{ axis.color }}",
                                        data: [{% for event in axis.values %}{{ event }}{% if not forloop.last %}, {% endif %}{% endfor %}]
                                        {% if not forloop.last %},type: 'line', pointRadius: 2, fill: false{% endif %}
                                    }{% if not forloop.last %},{% endif %}
                                {% endfor %}
                            ]
                        },
                        options: {
                            legend: {
                                display: false
                            },
                            legendCallback: function (chart) {
                                var text = [];
                                text.push('<ul class="' + chart.id + '-legend">');

                                var data = chart.data;
                                var datasets = data.datasets;
                                var labels = data.labels;

                                if (datasets.length) {
                                    if (datasets[0].data.length == 1) return '';
                                    for (var i = 0; i < datasets[0].data.length; ++i) {
                                        text.push('<li><span style="background-color:' + datasets[0].backgroundColor[i] + '"></span>');
                                        if (labels[i]) {
                                            text.push(labels[i]);
                                        }
                                        text.push('</li>');
                                    }
                                }

                                text.push('</ul>');
                                return text.join('');
                            },
                            scales: {
                                xAxes: [{
                                    display:false,
                                    barPercentage: 0.6,
                                    categoryPercentage: 0.7,
                                    ticks: {
                                        beginAtZero: true,
                                        display: false
                                    },
                                    gridLines: {
                                        display: false
                                    },
                                    scaleLabel: {
                                        display: false
                                    }
                                }],
                                yAxes: [{
                                    display:false,
                                    ticks: {
                                        beginAtZero: true,
                                        display: false
                                    },
                                    gridLines: {
                                        display: false
                                    }
                                }]
                            }
                        }
                    });
                {% endfor %}
            });
        </script>
    </section>

    <section class="bg-gray-v1">
        <div class="container">
            <div class="row">
                <div class="col-12 text-center">
                    <h2 class="h1">
                        Roadmap
                    </h2>

                    <div class="u-h-4 u-w-50 bg-primary rounded mx-auto mt-4 mb-5"></div>
                </div> <!-- END col-12-->
            </div> <!-- END row-->
        </div>
        {% if milestones %}
        <section id="cd-timeline" class="cd-container">
            <script src="https://rawgit.com/kottenator/jquery-circle-progress/1.2.2/dist/circle-progress.js"></script>
            <script>
                (function ($) {
                    $(function () {
                        $('.second.circle').each(function () {
                            var t = this;
                            (function(t){
                                new Waypoint({
                                  element: t,
                                  offset: '95%',
                                  handler: function(direction) {
                                      if (!$(t).data('completed')) {
                                          $(t).data('completed', true);
                                          $(t).circleProgress({
                                                fill: {
                                                    gradient: ['#fd5663', '#f08035']
                                                },
                                                lineCap: 'round',
                                                emptyFill: '#d7e4ed',
                                                value: parseInt($(t).data('value')) / 100
                                            }).on('circle-animation-progress', function (event, progress) {
                                                $(this).find('strong').html(Math.round(parseInt($(t).data('value')) * progress) + '<i>%</i>');
                                            });
                                      }
                                  }
                                });
                            })(t);
                        });
                    });
                })(jQuery);
            </script>
            {% for milestone in milestones %}
                <div class="cd-timeline-block">
                    <div class="cd-timeline-img">
                        <div class="second circle" data-size="68"
                             data-value="{{ milestone.percent|default_if_none:0 }}">
                            <strong></strong>
                        </div>
                    </div> <!-- cd-timeline-img -->

                    <div class="cd-timeline-content" {% if milestone.percent == 100 %}style="opacity:.4;" {% endif %}>
                        <h2>{{ milestone.name }}</h2>

                        <p>{{ milestone.description|default_if_none:'' }}</p>
                        {#				<a href="#0" class="cd-read-more">Read more</a>#}
                        <span class="cd-date">{{ milestone.date|date:"d.m.Y" }}</span>


                        <div class="like-buttons">
                            <button data-id="{{ milestone.id }}"
                                    {% if milestone.liked %}disabled {% endif %}
                                    class="{% if milestone.liked %}active disabled {% endif %} btn-outline-danger btn btn btn-sm btn-rounded js-milestone-like btn-danger px-md-4"
                                    style="margin: auto;">
                                <i class="fa fa-heart mr-1"></i> Do it!
                            </button>
                            <span class="btn btn btn-sm btn-rounded btn-danger px-md-4" style="margin: auto;cursor:default;">
                                <i class="fa fa-heart mr-1"></i> <span data-id="{{ milestone.id }}"
                                                                       class="js-milestone-likes-count">{{ milestone.likesHits.count }}</span>
                            </span>
                        </div>
                    </div> <!-- cd-timeline-content -->
                </div> <!-- cd-timeline-block -->
            {% endfor %}
        </section> <!-- cd-timeline -->
        {% else %}
            <div class="container text-center">
            <h3>This project hasn't any goals :(</h3>
            </div>
        {% endif %}
    </section>
    <script>
        var getProjectState = function (p, call) {
            $.post('/blockchain/ajax/', {'action': 'getProjectStatus', 'pName': p}, function (data) {
                if (data == 'ok')
                    call();
            });
        };
        $(function () {
            getProjectState('{{ project.name }}', function () {
                $('.js-donate').show();
            });
            var liked = {}, $mstcnt;
            $('.js-milestone-like').click(function () {
                if (!liked[$(this).data('id')]) {
                    liked[$(this).data('id')] = true;
                    $(this).addClass('active disabled').attr('disabled', 'disabled');
                    $mstcnt = $('.js-milestone-likes-count[data-id=' + $(this).data('id') + ']');
                    $mstcnt.text(parseInt($mstcnt.text()) + 1);
                    $.post(
                            '/project/{{ project.id }}/ajax/',
                            {
                                'action': 'like',
                                'mid': $(this).data('id')
                            },
                            function (data) {

                            },
                            'json'
                    );
                }
            });
        })
    </script>
    <script type="application/javascript" src="/static/js/libs/charts.2.7.1.js"></script>
{% endblock %}
