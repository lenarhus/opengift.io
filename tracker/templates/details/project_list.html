{% extends "public/index.html" %}
{% load thumbnail get_settings compressed %}
{% block content %}
    <section>
        <div id="bubbles"></div>
    </section>
    <script type="application/javascript" src="/static/js/libs/vis.js?v1"></script>
    <style>
        #bubbles {
            position: relative;
            width: 100%;
            height: 400px;
        }
    </style>
    <script type="application/javascript">
        $(function () {
            var nodes = new vis.DataSet([
                {% for k, spec in specialties.iteritems %}
                {
                    value: 20 * ({{ spec.subitems|length }} + 1),
                    label: "{{ spec.item.name }}",
                    subitems: [
                        {% for sub in spec.subitems %}
                            {
                                label: "{{ sub.item.name }}"
                            },
                        {% endfor %}
                    ]
                },
                {% endfor %}
            ]);
            var edges = new vis.DataSet();

            var container = document.getElementById('bubbles');
            var data = {
                nodes: nodes,
                edges: edges
            };

            var options = {
                interaction: {
                    zoomView: false,
                    dragView: false,
                    hover: true
                },
                nodes: {
                    borderWidth: 0,
                    shape: "dot",
                    color: {
                        background: '#F92C55',
                        highlight: {
                            background: '#F92C55',
                            border: '#F92C55'
                        }
                    },
                    font: {
                        color: '#000'
                    },
                    scaling: {
                        customScalingFunction: function (min, max, total, value) {
                            return value / total;
                        },
                        min: 20,
                        max: 100,
                        label: {
                            enabled: true
                        }
                    }
                },
                physics: {
                    stabilization: false,
                    minVelocity: 0.01,
                    solver: "repulsion",
                    repulsion: {
                        nodeDistance: 60
                    }
                }
            };
            var network = new vis.Network(container, data, options);

            var networkCanvas = document.getElementById("bubbles").getElementsByTagName("canvas")[0];
            // Events
            network.on("click", function (e) {
                if (e.nodes.length) {
                    var node = nodes.get(e.nodes[0]);
                    // Do something
{#                    nodes = node.subitems;#}
{#                    console.log(node);#}
                    if (node && node.subitems.length)
                        network.setData({'nodes':node.subitems, 'edges':edges});
                }
            });
            network.on("hoverNode", function (e) {
                if (e.node) {
                    var node = nodes.get(e.node);
                    if (node && node.subitems.length)
                        networkCanvas.style.cursor = 'pointer';
                }
            });
            network.on('blurNode', function (e) {
                networkCanvas.style.cursor = 'default';
            });
            setTimeout(function() {
                network.fit();
            }, 1000);
        });
    </script>
{% endblock %}
