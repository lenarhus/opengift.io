{% extends "public/index.html" %}
{% block content %}
    {% if not request.user.get_profile.blockchain_cert %}
        <section class="text-center">
            <h1>Создание кошелька</h1>
            <script>
                $(function () {
                    $.post('/blockchain/ajax/', {'action':'register'}, function(data) {
                        document.location.reload();
                    });
                })
            </script>
        </section>
    {% else %}
<section class="relative u-flex-center quadro-relative" style="
	background: #62bb94;
	background-image: -webkit-linear-gradient(left, #38c1d1 0%, #62bb94 100%);
	background-image: -o-linear-gradient(left, #38c1d1 0%, #62bb94 100%);
	background-image: -webkit-gradient(linear, left top, right top, from(#38c1d1), to(#62bb94));
	background-image: linear-gradient(to right, #38c1d1 0%, #62bb94 100%);
	background-repeat: repeat-x;
	filter: progid:DXImageTransform.Microsoft.gradient(startColorstr='#FF38c1d1', endColorstr='#FF62bb94', GradientType=1);
 ">

</section>
    <section class="u-py-md-250 u-flex-center with-waves">
        <svg width="100%" height="100%" version="1.1" xmlns="http://www.w3.org/2000/svg" class="wave wave-4"
             style="position: absolute;"><title>Wave</title>
            <defs></defs>
            <path id="feel-the-wave-four" d=""/>
        </svg>
      <div class="container" style="margin-top: -100px;">
        <div class="row align-items-center">
          <div class="col-lg-8 mx-auto">
                <div class="card box-shadow-v2 bg-white u-of-hidden text-center">
                    <div class="bg-gradient wallet-title m-0 py-3 p-md-5 u-pb-20 u-pt-25 text-white clearfix">
                        <div class="pull-left"><h2>Мой кошелек</h2></div>
                        <div class="pull-right">Баланс: <h2 class="js-wallet-balance">1200</h2> Gift</div>
                    </div>
                    <div class="p-4 p-md-5 bg-gray-v1 u-mb-35">
                        <form class="" action="" method="POST">
                            <div class="input-group box-shadow-v1 u-rounded-50 bg-white u-of-hidden">
                                <div class="input-group-addon bg-white border-0 pl-4 pr-0">
                                    Код кошелька:
                                </div>
                                <input type="text" class="form-control border-0 p-3 js-wallet-code" value="{{ request.user.get_profile.blockchain_wallet|default_if_none:'' }}" required="">
                                <button type="submit" class="input-group-btn btn btn-primary">
                                    <span class="icon fa fa-files-o text-white"></span>&nbsp;&nbsp;Скопировать
                                </button>
                            </div>
                        </form>
                    </div>

                    <div class="p-md-5 u-pb-20 u-pt-5">
                    <h5 align="left">Участие в проектах: <span class="js-projects-balance"></span></h5>
                            <p align="left" class="u-mb-50">Какой-то пояснительный текст текст перед проектами</p>
                        <div class="align-items-center u-pl-md-70 u-pr-md-70 ">
                            <div data-init="carousel" data-slick='{
				"slidesToShow":3,
				"slidesToScroll": 1,
				"arrows":true,
				"prevArrow":"<div class=\"slick-prev box-shadow-v1\"><i class=\"fa fa-angle-left\"></i></div>",
				"nextArrow":"<div class=\"slick-next box-shadow-v1\"><i class=\"fa fa-angle-right\"></i></div>",
				"responsive": [
						{
						 "breakpoint":1024,
						 "settings":{
							"slidesToShow": 2,
							"arrows":true,
							"dots":true,
							"dotsClass":"slick-dots dots-white mt-4 text-center"
						 }
						},
						{
						 "breakpoint":600,
						 "settings":{
							"slidesToShow": 1,
							"arrows":false,
							"dots":true,
							"dotsClass":"slick-dots dots-white mt-4 text-center"
						 }
						}
					]
				}'
                                 data-slick-margin="15">


                                <div class="rounded bg-white text-center box-shadow-v1">
                                    <div class="u-w-90-wrapper mb-4 u-mb-10 project-logo"
                                         style="background: url('https://ruclip.com/chimg/6a/UC1bcxBjAzvr5Gv7sVYVRXXQ.jpg');">
                                    </div>
                                    <div class="user-rating">10%</div>
                                    <div class="project-stars">
                                        <a href="#" data-rating="1" class="js-project-rating-star fa fa-star-o"></a>
                                        <a href="#" data-rating="2" class="js-project-rating-star fa fa-star-o"></a>
                                        <a href="#" data-rating="3" class="js-project-rating-star fa fa-star-o"></a>
                                        <a href="#" data-rating="4" class="js-project-rating-star fa fa-star-o"></a>
                                        <a href="#" data-rating="5" class="js-project-rating-star fa fa-star-o"></a>
                                    </div>
                                    <h6 class="u-mb-20"><a href="">Heliard</a></h6>


                                </div>
                                <div class="rounded bg-white text-center">
                                    <div class="u-w-90-wrapper mb-4 u-mb-10 project-logo"
                                         style="background: url('https://4.bp.blogspot.com/-JFNoEFKVEyA/WdYHVuQ24JI/AAAAAAAAAL0/AP7jekRTyd8mHwAuIt0axDE2KW6E_ZUPwCLcBGAs/s1600/400dpiLogo.jpg');">
                                    </div>
                                    <div class="user-rating">100%</div>

                                    <div class="project-stars">
                                        <a href="#" data-rating="1" class="js-project-rating-star fa fa-star-o"></a>
                                        <a href="#" data-rating="2" class="js-project-rating-star fa fa-star-o"></a>
                                        <a href="#" data-rating="3" class="js-project-rating-star fa fa-star-o"></a>
                                        <a href="#" data-rating="4" class="js-project-rating-star fa fa-star-o"></a>
                                        <a href="#" data-rating="5" class="js-project-rating-star fa fa-star-o"></a>
                                    </div>
                                    <h6 class="u-mb-20"><a href="">OpenGift.io</a></h6>

                                </div>
                                <div class="rounded bg-white text-center">
                                    <div class="u-w-90-wrapper mb-4 u-mb-10 project-logo"
                                         style="background: url('https://i.pinimg.com/736x/b9/c4/2b/b9c42b14c6c2875c2984efbed7e1d607--logos.jpg');">
                                    </div>
                                    <div class="user-rating">10% </div>

                                    <div class="project-stars">
                                        <a href="#" data-rating="1" class="js-project-rating-star fa fa-star-o"></a>
                                        <a href="#" data-rating="2" class="js-project-rating-star fa fa-star-o"></a>
                                        <a href="#" data-rating="3" class="js-project-rating-star fa fa-star-o"></a>
                                        <a href="#" data-rating="4" class="js-project-rating-star fa fa-star-o"></a>
                                        <a href="#" data-rating="5" class="js-project-rating-star fa fa-star-o"></a>
                                    </div>
                                    <h6 class="u-mb-20"><a href="">Название подлиннее</a></h6>

                                </div>
                                <div class="rounded bg-white text-center">
                                    <div class="u-w-90-wrapper mb-4 u-mb-10 project-logo"
                                         style="background: url('https://s-media-cache-ak0.pinimg.com/originals/eb/66/c4/eb66c4dceeaecf3d1a46226e934710cc.png');">
                                    </div>
                                    <div class="user-rating">10%</div>

                                    <div class="project-stars">
                                        <a href="#" data-rating="1" class="js-project-rating-star fa fa-star-o"></a>
                                        <a href="#" data-rating="2" class="js-project-rating-star fa fa-star-o"></a>
                                        <a href="#" data-rating="3" class="js-project-rating-star fa fa-star-o"></a>
                                        <a href="#" data-rating="4" class="js-project-rating-star fa fa-star-o"></a>
                                        <a href="#" data-rating="5" class="js-project-rating-star fa fa-star-o"></a>
                                    </div>
                                    <h6 class="u-mb-20"><a href="">Название, пожалуй, в три строки</a></h6>

                                </div>
                            </div>

                        </div> <!-- END row-->
                        </div>


<div class="p-md-5 u-pb-5 u-pt-5">
    <h5 align="left">Заголовок над кнопками</h5>
    <p align="left" class="u-mb-10">Какой-то пояснительный текст текст перед кнопками</p>

    <div class="u-pb-35 u-pt-5" align="left">
        <button type="button" class="btn btn-sm btn-green" data-toggle="modal" data-target="#target-wallet">
            Перевести на счет
        </button>&nbsp;&nbsp;&nbsp;
        <button type="button" class="btn btn-sm btn-pulple-light" data-toggle="modal" data-target="#target-project-token">
            Перевод токенов
        </button>
        &nbsp;&nbsp;&nbsp;
        <button type="button" class="btn btn-sm btn-yellow" data-toggle="modal" data-target="#target-project">
            Донейт
        </button>
    </div>
</div>



                 </div>
          </div> <!-- END col-lg-5-->
        </div> <!-- END row-->
      </div> <!-- END container-->
    </section>
    <script>
        $(function() {
            getKey(function() {
                getBalance();
            });
        });
        var getKey = function(callback) {
                $.post('/blockchain/ajax/', {'action':'getKey'}, function(data) {
                    $('.js-wallet-code').html(data);
                    callback();
                });
                return false;
            };
        var getBalance = function() {
                $.post('/blockchain/ajax/', {'action':'getBalance'}, function(data) {
                    data = $.parseJSON(data);
                    $('.js-wallet-balance').html(Math.round(data.Balance*10000)/10000);
                    if (data.Projects) {
                        var sp = '', n = 0;
                        for (var i in data.Projects) {
                            n++;
                            sp += i + ': <b class="js-project-'+n+'"></b>%; ' ;
                            (function(inner, number) {
                                getProjectState(inner, function(sum) {$('.js-project-'+number+'').text(sum);})
                            })(i, n);
                            $('.js-target-project-token').append('<option>'+i+'</option>')
                        }
                        $('.js-projects-balance').html(sp);
                    }
                });
                return false;
            };

        var getProjectState = function(p, call) {
            $.post('/blockchain/ajax/', {'action':'getProjectVals', 'pName': p}, function(data) {
                data = $.parseJSON(data);
                call(data['Users'][$('.js-wallet-code').text()]);
            });
        };

        var pay = function(wallet, sum) {
            $.post('/blockchain/ajax/', {'action':'pay', 'wallet': wallet, 'sum': sum}, function(data) {
                getBalance();
            });
            $('.js-target-wallet-sum, .js-target-wallet').val('');
        };

        var move = function(project, wallet, qty) {
            $.post('/blockchain/ajax/', {'action':'move', 'project': project, 'qty': qty, 'wallet': wallet}, function(data) {
                getBalance();
            });
            $('.js-target-project-token-sum, .js-target-project-token, .js-target-project-token-wallet').val('');
        };

        var donate = function(project, qty) {
            $.post('/blockchain/ajax/', {'action':'donate', 'project': project, 'qty': qty}, function(data) {
                getBalance();
            });
            $('.js-target-project, .js-target-project-sum').val('');
        }
    </script>

<!--Перевести на счет-->
<div class="modal fade" id="target-wallet" tabindex="-1" role="dialog" aria-hidden="true">
    <div class="modal-dialog" role="document">
        <div class="modal-content">
            <div class="modal-header bg-green">
                <h5 class="modal-title text-white">Перевести на счет</h5>
                <button type="button" class="close text-white" data-dismiss="modal" aria-label="Close">
                    <span aria-hidden="true">&times;</span>
                </button>
            </div>
            <div class="modal-body">

                <div class="u-mb-15">
                    <input type="text" name="" class="js-target-wallet" value="" placeholder="Сумма" />
                </div>
                <div>
                    <input type="text" name="" class="js-target-wallet-sum" value="" placeholder="Счет" />
                </div>

            </div>
            <div class="modal-footer">
                <button type="button" class="btn btn-secondary" data-dismiss="modal">Закрыть</button>
                <input type="button" value="Отправить" onclick="return pay($('.js-target-wallet').val(), $('.js-target-wallet-sum').val());" class="js-send-coins btn btn-primary" />
            </div>
        </div>
    </div>
</div>
<!--Перевод токенов-->
<div class="modal fade" id="target-project-token" tabindex="-1" role="dialog" aria-hidden="true">
    <div class="modal-dialog" role="document">
        <div class="modal-content">
            <div class="modal-header bg-purple-light">
                <h5 class="modal-title text-white">Перевод токенов</h5>
                <button type="button" class="close text-white" data-dismiss="modal" aria-label="Close">
                    <span aria-hidden="true">&times;</span>
                </button>
            </div>
            <div class="modal-body">

                <div class="u-mb-15">
                    <input type="text" name="" class="js-target-project-token-sum" value="" placeholder="Кол-во токенов" />
                </div>
                <div>
                    <input type="text" name="" class="js-target-project-token-wallet" value="" placeholder="Получатель" />
                </div>

            </div>
            <div class="modal-footer">
                <button type="button" class="btn btn-secondary" data-dismiss="modal">Закрыть</button>
                <input type="button" value="ОК" onclick="return move($('.js-target-project-token').val(), $('.js-target-project-token-wallet').val(), $('.js-target-project-token-sum').val());" class="js-move-tokens  btn btn-primary" />
            </div>
        </div>
    </div>
</div>
<!--Донейт-->
<div class="modal fade" id="target-project" tabindex="-1" role="dialog" aria-hidden="true">
    <div class="modal-dialog" role="document">
        <div class="modal-content">
            <div class="modal-header bg-yellow">
                <h5 class="modal-title text-white">Донейт</h5>
                <button type="button" class="close text-white" data-dismiss="modal" aria-label="Close">
                    <span aria-hidden="true">&times;</span>
                </button>
            </div>
            <div class="modal-body">

                <div class="u-mb-15">
                    <input type="text" name="" class="js-target-project-sum" value="" placeholder="Сумма" />
                </div>
                <div>
                    <input type="text" name="" class="js-target-project" value="" placeholder="Проект" />
                </div>

            </div>
            <div class="modal-footer">
                <button type="button" class="btn btn-secondary" data-dismiss="modal">Закрыть</button>
                <input type="button" value="ОК" onclick="return donate($('.js-target-project').val(), $('.js-target-project-sum').val());" class="js-donate btn btn-primary" />
            </div>
        </div>
    </div>
</div>
    {% endif %}
{%  endblock %}
